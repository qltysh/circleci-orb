description: |
  Effortlessly publish your code coverage reports to Qlty Cloud
  with minimal configuration.

  Note: For Alpine-based executors, ensure that `coreutils` and `curl` are installed.
parameters:
  files:
    description: Path to the code coverage report files to upload.
    type: string
    default: ""
  tag:
    description: The name of the tag to use for the coverage report.
    type: string
    default: ""
  add_prefix:
    description: |
      The prefix to add to file paths in coverage payloads,
      to make them match the project's directory structure.
    type: string
    default: ""
  transform_add_prefix:
    description: |
      [Deprecated] The prefix to add to file paths in coverage payloads,
      to make them match the project's directory structure.
    type: string
    default: ""
  strip_prefix:
    description: |
      The prefix to remove from absolute paths in coverage
      payloads, to make them relative to the project root.
      This is usually the directory in which the tests were
      run. Defaults to current working directory.
    type: string
    default: ""
  tansform_strip_prefix:
    description: |
      [Deprecated] The prefix to remove from absolute paths in
      coverage payloads, to make them relative to the project root.
      This is usually the directory in which the tests were
      run. Defaults to current working directory.
    type: string
    default: ""
  verbose:
    description: Enable extra logging.
    type: boolean
    default: false
  skip_missing_files:
    description: |
      Skip coverage data of files that don't exist on the file system.
    type: boolean
    default: false
  token:
    description: |
      The Qlty code coverage token provided through your
      Qlty's project settings. The orb will look for the
      QLTY_COVERAGE_TOKEN environment variable by default.
    type: string
    default: "QLTY_COVERAGE_TOKEN"
  total_parts_count:
    description: The total number of parts qlty cloud should expect to receive
    type: integer
    default: 1
  working_directory:
    description: The directory where to run the Qlty CLI.
    type: string
    default: "."
steps:
  - run:
      name: Install Qlty CLI
      command: <<include(scripts/install)>>
  - run:
      name: Publish Coverage Results
      command: <<include(scripts/publish)>>
      environment:
        PARAM_FILES: << parameters.files >>
        PARAM_TAG: << parameters.tag >>
        PARAM_ADD_PREFIX: << parameters.add_prefix >>
        PARAM_STRIP_PREFIX: << parameters.strip_prefix >>
        PARAM_SKIP_MISSING_FILES: << parameters.skip_missing_files >>
        PARAM_VERBOSE: << parameters.verbose >>
        PARAM_TOKEN: << parameters.token >>
        PARAM_TOTAL_PARTS_COUNT: << parameters.total_parts_count >>
        PARAM_WORKING_DIRECTORY: << parameters.working_directory >>
        PARAM_TRANSFORM_ADD_PREFIX: << parameters.transform_add_prefix >>
        PARAM_TRANSFORM_STRIP_PREFIX: << parameters.transform_strip_prefix >>
